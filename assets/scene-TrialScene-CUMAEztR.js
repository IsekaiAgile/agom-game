class y extends Phaser.Scene{constructor(){super({key:"TrialScene"}),this.player=null,this.cursors=null,this.jumpKey=null,this.isGameOver=!1,this.introComplete=!1}preload(){this.load.audio("trial-bgm","audio/trial-bgm.mp3"),this.load.image("trial-bg-far","images/trial/bg-far.png"),this.load.image("trial-bg-mid","images/trial/bg-mid.png")}create(){console.log("TrialScene: create started"),this.showIntroduction()}showIntroduction(){const e=this.add.rectangle(640,360,1280,720,0),t=["……ここは、どこだ……？","見たこともない場所だ……","……何が起こってるんだ"];let s=0,i=!1;const a=this.add.text(640,300,"",{fontSize:"40px",color:"#ffffff",fontFamily:"sans-serif",align:"center",stroke:"#000000",strokeThickness:4}).setOrigin(.5),o=this.add.text(640,600,"▼ クリックで続ける",{fontSize:"24px",color:"#aaaaaa"}).setOrigin(.5);o.setVisible(!1),this.tweens.add({targets:o,alpha:.3,duration:500,yoyo:!0,repeat:-1});const r=d=>{i=!0,o.setVisible(!1),a.setText("");let n=0;const h=this.time.addEvent({delay:80,callback:()=>{n<d.length?(a.setText(d.substring(0,n+1)),n++):(h.remove(),i=!1,o.setVisible(!0))},loop:!0})},l=()=>{if(!i){if(s>=t.length){e.destroy(),a.destroy(),o.destroy(),this.input.off("pointerdown",l),this.startGame();return}r(t[s]),s++}};l(),this.input.on("pointerdown",l)}startGame(){console.log("Starting game..."),this.introComplete=!0,this.createParallaxBackground();const e=this.add.text(640,50,"？？？",{fontSize:"48px",color:"#ff6400",fontFamily:"sans-serif",fontStyle:"bold"}).setOrigin(.5);e.setScrollFactor(0),e.setDepth(100);const t=this.add.text(640,120,"← → キーで移動、スペースでジャンプ",{fontSize:"20px",color:"#ffffff",fontFamily:"sans-serif"}).setOrigin(.5);t.setScrollFactor(0),t.setDepth(100),this.createGround(),this.createPlayer(),this.createEnemies(),this.createGoal(),this.physics.world.setBounds(0,0,3e3,720),this.cameras.main.setBounds(0,0,3e3,720),this.cameras.main.startFollow(this.player,!0,.1,.1),this.cursors=this.input.keyboard.createCursorKeys(),this.jumpKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.createTouchControls(),this.bgm=this.sound.add("trial-bgm",{loop:!0,volume:.5}),this.bgm.play(),console.log("Game started!")}createParallaxBackground(){const t=this.add.tileSprite(0,0,6e3,720,"trial-bg-far");t.setOrigin(0,0),t.setScrollFactor(.1);const s=this.add.tileSprite(0,0,3e3*2,720,"trial-bg-mid");s.setOrigin(0,0),s.setScrollFactor(.5);for(let i=0;i<30;i++){const a=Phaser.Math.Between(0,3e3),o=Phaser.Math.Between(0,720),r=Phaser.Math.Between(3,8),l=this.add.circle(a,o,r,16746496,.4);l.setScrollFactor(1.2),this.tweens.add({targets:l,y:o+Phaser.Math.Between(-20,20),alpha:Phaser.Math.FloatBetween(.2,.6),duration:Phaser.Math.Between(2e3,4e3),yoyo:!0,repeat:-1})}}createGround(){this.platforms=this.physics.add.staticGroup();const e=650,t=70;for(let o=0;o<10;o++){const r=this.add.rectangle(150+o*300,e,300,t,16737280);this.physics.add.existing(r,!0),this.platforms.add(r)}const s=this.add.rectangle(800,550,200,30,16755200);this.physics.add.existing(s,!0),this.platforms.add(s);const i=this.add.rectangle(1200,450,200,30,16755200);this.physics.add.existing(i,!0),this.platforms.add(i);const a=this.add.rectangle(1600,550,200,30,16755200);this.physics.add.existing(a,!0),this.platforms.add(a)}createPlayer(){this.player=this.add.rectangle(100,500,40,60,65535),this.physics.add.existing(this.player),this.player.body.setCollideWorldBounds(!0),this.player.body.setGravityY(800),this.physics.add.collider(this.player,this.platforms),this.player.isJumping=!1}createEnemies(){this.enemies=this.physics.add.group();const e=this.add.rectangle(600,600,50,50,16711680);this.physics.add.existing(e),e.body.setCollideWorldBounds(!0),e.body.setGravityY(800),e.body.setVelocityX(-50),this.enemies.add(e);const t=this.add.rectangle(1e3,600,50,50,16711680);this.physics.add.existing(t),t.body.setCollideWorldBounds(!0),t.body.setGravityY(800),t.body.setVelocityX(50),this.enemies.add(t);const s=this.add.rectangle(1800,600,50,50,16711680);this.physics.add.existing(s),s.body.setCollideWorldBounds(!0),s.body.setGravityY(800),s.body.setVelocityX(-50),this.enemies.add(s),this.physics.add.collider(this.enemies,this.platforms),this.enemies.children.entries.forEach(i=>{i.body.setBounce(1,0)}),this.physics.add.overlap(this.player,this.enemies,this.hitEnemy,null,this)}createGoal(){this.goal=this.add.rectangle(2800,500,100,200,65280),this.physics.add.existing(this.goal,!0),this.add.text(2800,400,"GOAL",{fontSize:"48px",color:"#00ff00",fontFamily:"sans-serif",fontStyle:"bold"}).setOrigin(.5),this.physics.add.overlap(this.player,this.goal,this.reachGoal,null,this)}createTouchControls(){this.input.on("pointerdown",e=>{if(this.isGameOver||!this.introComplete)return;const t=this.cameras.main.width;e.x<t/3?this.player.body.setVelocityX(-200):e.x>t*2/3?this.player.body.setVelocityX(200):e.y<300&&this.player.body.touching.down&&this.player.body.setVelocityY(-400)})}hitEnemy(e,t){this.tweens.add({targets:e,alpha:.3,duration:100,yoyo:!0,repeat:3,onComplete:()=>{e.alpha=1}}),t.x-=200}reachGoal(e,t){if(this.isGameOver)return;console.log("Goal reached!"),this.isGameOver=!0,this.bgm&&this.bgm.isPlaying&&this.bgm.stop(),this.player.body.setVelocity(0,0);const s=this.add.rectangle(640,360,1280,720,0,.8);s.setScrollFactor(0),s.setDepth(100);const i=this.add.text(640,300,"クリア！",{fontSize:"64px",color:"#00ff00",fontFamily:"sans-serif",fontStyle:"bold"}).setOrigin(.5);i.setScrollFactor(0),i.setDepth(101);const a=this.add.rectangle(640,450,300,80,16737280);a.setScrollFactor(0),a.setDepth(101),a.setInteractive({useHandCursor:!0});const o=this.add.text(640,450,"続ける",{fontSize:"32px",color:"#000000",fontFamily:"sans-serif",fontStyle:"bold"}).setOrigin(.5);o.setScrollFactor(0),o.setDepth(102),a.on("pointerdown",()=>{this.bgm&&this.bgm.stop(),this.scene.start("AjadraScene")})}update(){this.isGameOver||!this.introComplete||(this.cursors.left.isDown?this.player.body.setVelocityX(-200):this.cursors.right.isDown?this.player.body.setVelocityX(200):this.player.body.setVelocityX(this.player.body.velocity.x*.9),Phaser.Input.Keyboard.JustDown(this.jumpKey)&&this.player.body.touching.down&&this.player.body.setVelocityY(-400),this.player.y>720&&this.gameOver())}gameOver(){if(this.isGameOver)return;this.isGameOver=!0,this.bgm&&this.bgm.isPlaying&&this.bgm.stop();const e=this.add.rectangle(640,360,1280,720,2228224,.9);e.setScrollFactor(0),e.setDepth(100);const t=this.add.text(640,300,"GAME OVER",{fontSize:"64px",color:"#ff0000",fontFamily:"sans-serif",fontStyle:"bold"}).setOrigin(.5);t.setScrollFactor(0),t.setDepth(101);const s=this.add.rectangle(640,450,300,80,16737280);s.setScrollFactor(0),s.setDepth(101),s.setInteractive({useHandCursor:!0});const i=this.add.text(640,450,"リトライ",{fontSize:"32px",color:"#000000",fontFamily:"sans-serif",fontStyle:"bold"}).setOrigin(.5);i.setScrollFactor(0),i.setDepth(102),s.on("pointerdown",()=>{this.scene.restart()})}}export{y as T};
